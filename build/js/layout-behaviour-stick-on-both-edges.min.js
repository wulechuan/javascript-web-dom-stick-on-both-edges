module.exports=function(e){function n(e,n){function t(){return n+Date.now()+"-"+(1e6*Math.random()+"").slice(0,6)}n="string"==typeof n?n:"",n=n.replace(/\-+$/,"")+"-";for(var o=t();e[o];)o=t();return o}function t(e,n){if(!e||"object"!=typeof e)return null;if(!n||"object"!=typeof n)return e;for(var t in n){var o=n[t];void 0!==o&&(Array.isArray(o)&&Array.isArray(e[t])?Array.prototype.push.apply(e[t],o):e[t]=o)}return e}return function(e,n,t,o){"use strict";function a(e,n){e.config(n),r(e),B.call(e,n,!0),"boolean"==typeof n.shouldEnable?y.call(n.shouldEnable,n.reasonForEnablingOrDisabling||n.reason||"User desired on initialization."):e.options.shouldEnableOnInit&&p.call(e,"Forced to enabled on initialization."),Y.call(e);var t=i(e).boundFunctions;window.addEventListener("scroll",t.listenToWindowOnScrollEvent)}function i(e){return ae[e.__pToken]}function r(e){var n=i(e).boundFunctions;n.doIntervalOfRenewingState=F.bind(null,e),n.doIntervalOfLayoutUpdate=R.bind(null,e),n.doUpdateLayout=function(){q(e)}.bind(e);var t=o(e.options.throttleTimeInMSForScrollAndResizeListeners,n.doUpdateLayout);n.listenToWindowOnScrollEvent=t,n.listenToWindowOnResizeEvent=t}function s(){return i(this).state.isEnabled}function l(){var e=i(this).state.layouts;if(e.isFreeLayout)return"free layout";if(e.isPinnedToWindowTop)return"pinned to top";if(e.isPinnerToParentBottom)return"following lower boundry";throw RangeError(ee,"Fatal: None of the three states are active.")}function u(e){var n=i(this).state.layouts;if(!e||"string"!=typeof e)return!1;switch(e.toLowerCase().replace(/\s*[\s\-]\s*/g,"-").replace(/^\s+/,"").replace(/\s+$/,"")){case"free":case"freelayout":case"default":return n.isFreeLayout;case"top":case"hanging":case"pinned-to-top":return n.isPinnedToWindowTop;case"following":case"bottom":case"following-lower-boundry":case"pinned-to-bottom":return n.isPinnerToParentBottom}return!1}function d(e){var n,t,o,a=this,i=a.options,r=a.elements;n="hangingLowerBoundryRef",t=n+"El",e.hasOwnProperty(t)&&(o=e[t],r[n]instanceof Node?o instanceof Node&&(r[n]=o):o instanceof Node?r[n]=o:r[n]=r.parentPositionRef),n="intervalTimeInMSForRenewingState",e.hasOwnProperty(n)&&(o=parseInt(e[n]),!isNaN(o)&&o>20&&(i[n]=o)),n="intervalTimeInMSForUpdatingLayout",e.hasOwnProperty(n)&&(o=parseInt(e[n]),!isNaN(o)&&o>20&&(i[n]=o)),c(a,"onEnabling",e),c(a,"onEnabled",e),c(a,"onDisabling",e),c(a,"onDisabled",e),c(a,"onDestroying",e),c(a,"onDestroyed",e),c(a,"onReturningToFreeLayout",e),c(a,"onReturnedToFreeLayout",e),c(a,"onIntervalBegin",e),c(a,"onIntervalEnd",e)}function c(e,n,t){var o=i(e).events,a=t[n];"function"!=typeof a&&void 0!==a||(o[n]=a)}function f(e,n,t){var o=i(e).events;return"function"!=typeof o[n]?void(t&&oe.warn('The "'+n+'" is NOT handled.')):o[n].call(e,e.state)}function g(e){T.call(this,e,!0)}function h(e){var n=e.elements,t=i(e).boundFunctions;window.removeEventListener("scroll",t.listenToWindowOnScrollEvent),window.removeEventListener("resize",t.listenToWindowOnResizeEvent),n.root.style.height="",n.chiefContent.style.top="",Z(e,null),f(e,"onDestroyed",!0)}function y(e,n,t){if(void 0!==e){e=!!e;if(w(this,e,t)){var o=e?"Enabling":t?"DESTORYING":"DISABLING";return void oe.warn(o,"request was cancelled.")}var a={};a.shouldEnable=!!e,a.reason=n&&"string"==typeof n?n:"<unkown>",!e&&t&&(a.isForcedToRenew=!0,a.shouldDestroyAfterDisabled=!0),M.call(this,a),Y.call(this)}}function p(e){y.call(this,!0,e)}function T(e,n){y.call(this,!1,e,n)}function w(e,n,t){if(n)return f(e,"onEnabling");var o=f(e,"onDisabling");if(o){if(!t)return o;oe.warn("Destroying request will be cancelled by onDisabling handler.")}return f(e,"onDestroying")}function v(e,n){var t=e.state;i(e).state.isEnabled=n,n?(delete t.shouldDestroyAfterDisabled,f(e,"onEnabled")):(f(e,"onDisabled"),e.clearIntervalOfRenewingState(),e.clearIntervalOfLayoutUpdate(),t.shouldDestroyAfterDisabled&&h(e))}function L(){b(this,!0)}function m(){b(this,!1)}function b(e,n){var t=i(e),o=t.state,a=n?"Starting":"STOPPING",r="interval for renewing related info.",s="intervalIDForRenewingState",l=o[s],u=!isNaN(l);n&&!u?(oe.info(a,r),o[s]=setInterval(t.boundFunctions.doIntervalOfRenewingState,e.options.intervalTimeInMSForRenewingState)):!n&&u&&(oe.warn(a,r),clearInterval(l),o[s]=NaN)}function F(e){f(e,"onIntervalBegin")||(O.call(e,!0),k.call(e,!0),C.call(e,!0),D.call(e,!0)),f(e,"onIntervalEnd")}function I(){E(this,!0)}function N(){E(this,!1)}function E(e,n){var t=i(e),o=t.state,a=n?"Starting":"STOPPING",r="intervalIDForUpdatingLayout",s=o[r],l=!isNaN(s);n&&!l?(oe.info(a,"interval for updating layout."),o[r]=setInterval(t.boundFunctions.doIntervalOfLayoutUpdate,e.options.intervalTimeInMSForUpdatingLayout)):!n&&l&&(oe.warn(a,"interval for updating layout."),clearInterval(s),o[r]=NaN)}function R(e){Y.call(e)}function S(e){B.call(this,e,!1),Y.call(this)}function B(e,n){var t=!0;"object"==typeof e&&e&&(P.call(this,e.contentTopToWindowTopInHangingLayouts,n),U.call(this,e.contentBottomToLowerBoundryInHangingLayouts,n),t=W.call(this,e.shouldUseBottomOfHangingLowerBoundryRef,n)),t&&k.call(this,n),O.call(this,n),C.call(this,n),D.call(this,n)}function O(e){var n={blockHeight:this.elements.chiefContent.offsetHeight};e&&(n.isForcedToUpdate=!0),M.call(this,n)}function C(e){var n={};e&&(n.isForcedToUpdate=!0),n.contentTopToRootTopInFreeLayout=this.elements.chiefContent.offsetTop,M.call(this,n)}function P(e,n){var t={};n&&(t.isForcedToUpdate=!0),e=parseFloat(e),isNaN(e)||(t.contentTopToWindowTopInHangingLayouts=e),M.call(this,t)}function U(e,n){var t={};n&&(t.isForcedToUpdate=!0),e=parseFloat(e),isNaN(e)||(t.contentBottomToLowerBoundryInHangingLayouts=e),M.call(this,t)}function D(e){var n,t=this,o=i(t).state,a=!0,r=!0;o.layouts.isFreeLayout||(e?(o.shouldRenewFreeLayoutInfoNextTimeEnteringFreeLayout=!1,n=t.state.methodForSwitchingToCurrentLayout,r=$(t,e,!0)):(a=!1,o.shouldRenewFreeLayoutInfoNextTimeEnteringFreeLayout=!0)),a&&H(t,e),r||"function"!=typeof n||n(t)}function H(e,n){var t=e.elements.chiefContent.getBoundingClientRect();if(0===t.width&&0===t.height)return void oe.warn('\n\t Cannot evaluate chiefContentEl\'s "boundingClientRect"!',"\n\t The chief content elment might not be visible at the moment.");var o={};n&&(o.isForcedToUpdate=!0),o.contentTopToPageTopInFreeLayout=t.top+window.scrollY,M.call(e,o)}function W(e,n){var t=this,o=t.elements;if(o.parentPositionRef===o.hangingLowerBoundryRef||null===e||void 0===e)return!0;t.state.shouldUseBottomOfHangingLowerBoundryRef=!!e;var a={};return n&&(a.isForcedToUpdate=!0),k.call(this,n),!1}function k(e){var n=A(this);e&&(n.isForcedToUpdate=!0),M.call(this,n)}function A(e){var n=e.state,t="hangingLowerBoundryToPageTop",o=NaN,a=NaN,r=e.elements.hangingLowerBoundryRef.getBoundingClientRect();0===r.width&&0===r.height?oe.warn("Reference element for deciding hanging lower boundry is invisible at this moment."):(o=r[n.shouldUseBottomOfHangingLowerBoundryRef?"bottom":"top"],a=o+window.scrollY),i(e).state.hangingLowerBoundryToWindowTop=o,n[t]=a;var s={};return s[t]=a,s}function M(e){var n=this,o=i(n).updatingStatesQueue;!o[o.length-1]&&o.push({});var a=o[o.length-1];"function"==typeof e?e.call(n,a):"object"!=typeof e||Array.isArray(e)?a.isForcedToUpdate=a.isForcedToUpdate||void 0===e||!!e:t(a,e)}function j(e){var n=i(e),t=n.updatingStatesQueue.shift();return z(e,e.state,t),t}function x(e,n){t(e.state,n)}function z(e,n,t){G(e,n,t),Q(e,t)}function G(e,n,t){Object.keys(e.state).forEach(function(o){_(o,n,t)?i(e).state.somethingChanged=!0:delete t[o]})}function _(e,n,t){var o=!1,a=n[e],i=t[e];return void 0!==i&&null!==i&&(void 0===a||null===a?o=!0:a!==i&&(o=!(isNaN(a)&&isNaN(i))),o)}function Q(e,n){if(i(e).state.somethingChanged){var t,o,a,r;if("boolean"==typeof n.shouldEnable){t="reason";var s=n.shouldEnable;o=s?"Enabling":n.shouldDestroyAfterDisabled?"DESTORYING":"DISABLING",a="behaviour...\n",r=n[t],r=ne.slice("Reason: ".length)+"Reason: "+r.replace(/\n/g,"\n "+ne),s?oe.info(o,a,r):oe.warn(o,a," ",r)}}}function Y(){var e=this,n=i(e),t=e.state;if(!(n.updatingStatesQueue.length<1)){var o=j(e),a=o.isForcedToUpdate;delete o.isForcedToUpdate,(n.state.somethingChanged||a)&&(x(e,o),q(e,a)),"boolean"==typeof o.shouldEnable&&(v(e,o.shouldEnable),delete t.reason)}}function q(e,n){var t=i(e).state,o=e.state,a=e.elements;A(e);var r=o.contentTopToWindowTopInHangingLayouts,s=window.scrollY+r,l=o.hangingLowerBoundryToPageTop-o.contentTopToPageTopInFreeLayout,u=o.blockHeight+o.contentBottomToLowerBoundryInHangingLayouts,d=t.hangingLowerBoundryToWindowTop-r,c=o.blockHeight,f=window.innerHeight<u||!isNaN(l)&&l<u;!o.shouldEnable||f||s<=o.contentTopToPageTopInFreeLayout?$(e,n):d<=u?J(e,n,c,l-u+a.root.clientTop+o.contentTopToRootTopInFreeLayout):V(e,n,c,o.contentTopToWindowTopInHangingLayouts),t.somethingChanged=!1,delete o.methodForSwitchingToCurrentLayout}function $(e,n,t){var o=i(e).state,a=o.layouts.isFreeLayout,r=K(e,{methodForSwitchingToCurrentLayout:$,isForcedToUpdate:n,pNameOfLayoutMark:"isFreeLayout",pNameOfCssClass:t?"layoutFreeTemporary":"layoutFree",rootElHeight:"",contentElTop:""});if(!r){var s=e.options.shouldAlwaysRenewFreeLayoutInfo;!s&&!o.shouldRenewFreeLayoutInfoNextTimeEnteringFreeLayout||a||S.call(e),o.shouldRenewFreeLayoutInfoNextTimeEnteringFreeLayout=!1}return r}function V(e,n,t,o){return K(e,{methodForSwitchingToCurrentLayout:V,isForcedToUpdate:n,pNameOfLayoutMark:"isPinnedToWindowTop",pNameOfCssClass:"layoutPinToWindowTop",rootElHeight:t+"px",contentElTop:o+"px"})}function J(e,n,t,o){return K(e,{methodForSwitchingToCurrentLayout:J,isForcedToUpdate:n,pNameOfLayoutMark:"isPinnerToParentBottom",pNameOfCssClass:"layoutPinToParentBottom",rootElHeight:t+"px",contentElTop:o+"px"})}function K(e,n){var t=i(e).state,o=e.state,a=e.elements,r=n.pNameOfLayoutMark,s=n.logStringWhenActuallySwitching;return!(!t.layouts[r]||t.somethingChanged||n.isForcedToUpdate)||(n.shouldDebug&&s&&oe.info(s),o.methodForSwitchingToCurrentLayout=n.methodForSwitchingToCurrentLayout,X(e,r),Z(e,n.pNameOfCssClass),a.chiefContent.style.top=n.contentElTop,a.root.style.height=n.rootElHeight,!1)}function X(e,n){var t=i(e).state.layouts;Object.keys(t).forEach(function(e){t[e]=n===e})}function Z(e,n){var t=e.elements.chiefContent.classList,o=e.options.cssClassName;for(var a in o){var i=o[a];a===n?i&&t.add(i):i&&t.remove(i)}}var ee="{"+e+"} ==>",ne=ee.replace(/\S/g," "),te=window.console,oe={};["log","info","warn","debug","trace","error"].forEach(function(e){var n=te[e];"function"==typeof n&&(oe[e]=n.bind(te,ee))});var ae={};return function(t){var o=this;if(o.console=oe,o.options={shouldEnableOnInit:!1,shouldAlwaysRenewFreeLayoutInfo:!0,cssClassName:{layoutFreeTemporary:"js-stick-on-both-edges-layout-temporarily-free",layoutFree:"js-stick-on-both-edges-layout-free",layoutPinToWindowTop:"js-stick-on-both-edges-layout-hang-to-window-top",layoutPinToParentBottom:"js-stick-on-both-edges-layout-pin-to-lower-boundry"},intervalTimeInMSForRenewingState:500,intervalTimeInMSForUpdatingLayout:40,throttleTimeInMSForScrollAndResizeListeners:16},o.state={shouldEnable:!1,blockHeight:NaN,contentTopToPageTopInFreeLayout:NaN,contentTopToRootTopInFreeLayout:0,contentTopToWindowTopInHangingLayouts:0,contentBottomToLowerBoundryInHangingLayouts:15,shouldUseBottomOfHangingLowerBoundryRef:!1,hangingLowerBoundryToPageTop:NaN},t=t||{},!(t.parentPositionRefEl instanceof Node))throw new Error("Invalid parentPositionRef element.");if(!(t.rootEl instanceof Node))throw new Error("Invalid root element.");if(!(t.chiefContentEl instanceof Node))throw new Error("Invalid chiefContent element.");o.elements={root:t.rootEl,chiefContent:t.chiefContentEl,parentPositionRef:t.parentPositionRefEl,hangingLowerBoundryRef:null};var i={state:{layouts:{isFreeLayout:!0,isPinnedToWindowTop:!1,isPinnerToParentBottom:!1},isEnabled:!1,somethingChanged:!1,hangingLowerBoundryToWindowTop:NaN,shouldRenewFreeLayoutInfoNextTimeEnteringFreeLayout:!1,intervalIDForRenewingState:NaN,intervalIDForUpdatingLayout:NaN},events:{},boundFunctions:{},updatingStatesQueue:[]};o.__pToken=n(ae,e),ae[o.__pToken]=i,o.config=d,o.isEnabled=s,o.currentLayout=l,o.currentLayoutIs=u,o.enableOrDisable=y,o.enable=p,o.disable=T,o.destroy=g,o.renewStateAndThenUpdate=S,o.renewState=B,o.renewContentTopToWindowTopInHangingLayouts=P,o.renewHangingLowerBoundryValue=k,o.renewHangingLowerBoundryUsedBorder=W,o.startIntervalOfRenewingState=L,o.clearIntervalOfRenewingState=m,o.startIntervalOfLayoutUpdate=I,o.clearIntervalOfLayoutUpdate=N,o.requestLayoutUpdate=M,o.updateLayout=Y,a(o,t)}}("StickOnBothEdges",n,t,window.jQuery.throttle)}();