module.exports=function(e){function t(e,t){function n(){return t+Date.now()+"-"+(1e6*Math.random()+"").slice(0,6)}t="string"==typeof t?t:"",t=t.replace(/\-+$/,"")+"-";for(var o=n();e[o];)o=n();return o}function n(e,t){if(!e||"object"!=typeof e)return null;if(!t||"object"!=typeof t)return e;for(var n in t){var o=t[n];void 0!==o&&(Array.isArray(o)&&Array.isArray(e[n])?Array.prototype.push.apply(e[n],o):e[n]=o)}return e}function o(e,t){if(!(e instanceof Node&&t instanceof Node))return!1;for(var n=!1;e!==t&&e!==document.documentElement;)(e=e.parentNode)===t&&(n=!0);return n}return function(e,t,n,o,a){"use strict";function r(e,t){e.config(t),s(e),S.call(e,t,!0),"boolean"==typeof t.shouldEnable?p.call(t.shouldEnable,t.reasonForEnablingOrDisabling||t.reason||"User desired on initialization."):e.options.shouldEnableOnInit&&T.call(e,"Forced to enabled on initialization."),$.call(e);var n=i(e).boundFunctions;window.addEventListener("scroll",n.listenToScrollEvent)}function i(e){return ie[e.__pToken]}function s(e){var t=i(e).boundFunctions;t.doIntervalOfRenewingState=E.bind(null,e),t.doIntervalOfLayoutUpdate=B.bind(null,e),t.doUpdateLayout=function(){V(e)}.bind(e);var n=a(e.options.throttleTimeForScrollAndResizeListeners,t.doUpdateLayout);t.listenToScrollEvent=n,t.listenToResizeEvent=n}function l(){return i(this).state.isEnabled}function u(){var e=i(this).state.layouts;if(e.isFreeLayout)return"free layout";if(e.isPinnedToWindowTop)return"pinned to top";if(e.isPinnerToParentBottom)return"following lower boundary";throw RangeError(ne,"Fatal: None of the three states are active.")}function d(e){var t=i(this).state.layouts;if(!e||"string"!=typeof e)return!1;switch(e.toLowerCase().replace(/\s*[\s\-]\s*/g,"-").replace(/^\s+/,"").replace(/\s+$/,"")){case"free":case"freelayout":case"default":return t.isFreeLayout;case"top":case"hanging":case"pinned-to-top":return t.isPinnedToWindowTop;case"following":case"bottom":case"following-lower-boundary":case"pinned-to-bottom":return t.isPinnerToParentBottom}return!1}function c(e){var t,n,o=this,a=o.options;o.elements;t="intervalTimeForRenewingState",e.hasOwnProperty(t)&&(n=parseInt(e[t]),!isNaN(n)&&n>20&&(a[t]=n)),t="intervalTimeForUpdatingLayout",e.hasOwnProperty(t)&&(n=parseInt(e[t]),!isNaN(n)&&n>20&&(a[t]=n)),f(o,"onEnabling",e),f(o,"onEnabled",e),f(o,"onDisabling",e),f(o,"onDisabled",e),f(o,"onDestroying",e),f(o,"onDestroyed",e),f(o,"onReturningToFreeLayout",e),f(o,"onReturnedToFreeLayout",e),f(o,"onIntervalBegin",e),f(o,"onIntervalEnd",e)}function f(e,t,n){var o=i(e).events,a=n[t];"function"!=typeof a&&void 0!==a||(o[t]=a)}function h(e,t,n){var o=i(e).events;return"function"!=typeof o[t]?void(n&&re.warn('The "'+t+'" is NOT handled.')):o[t].call(e,e.state)}function y(e){w.call(this,e,!0)}function g(e){var t=e.elements,n=i(e).boundFunctions;window.removeEventListener("scroll",n.listenToScrollEvent),window.removeEventListener("resize",n.listenToResizeEvent),t.root.style.height="",t.chiefContent.style.top="",te(e,null),h(e,"onDestroyed",!0)}function p(e,t,n){if(void 0!==e){e=!!e;if(v(this,e,n)){var o=e?"Enabling":n?"DESTORYING":"DISABLING";return void re.warn(o,"request was cancelled.")}var a={};a.shouldEnable=!!e,a.reason=t&&"string"==typeof t?t:"<unkown>",!e&&n&&(a.isForcedToRenew=!0,a.shouldDestroyAfterDisabled=!0),z.call(this,a),$.call(this)}}function T(e){p.call(this,!0,e)}function w(e,t){p.call(this,!1,e,t)}function v(e,t,n){if(t)return h(e,"onEnabling");var o=h(e,"onDisabling");if(o){if(!n)return o;re.warn("Destroying request will be cancelled by onDisabling handler.")}return h(e,"onDestroying")}function m(e,t){var n=e.state;i(e).state.isEnabled=t,t?(delete n.shouldDestroyAfterDisabled,h(e,"onEnabled")):(h(e,"onDisabled"),e.clearIntervalOfRenewingState(),e.clearIntervalOfLayoutUpdate(),n.shouldDestroyAfterDisabled&&g(e))}function L(){F(this,!0)}function b(){F(this,!1)}function F(e,t){var n=i(e),o=n.state,a=t?"Starting":"STOPPING",r="interval for renewing related info.",s="intervalIDForRenewingState",l=o[s],u=!isNaN(l);t&&!u?(re.info(a,r),o[s]=setInterval(n.boundFunctions.doIntervalOfRenewingState,e.options.intervalTimeForRenewingState)):!t&&u&&(re.warn(a,r),clearInterval(l),o[s]=NaN)}function E(e){h(e,"onIntervalBegin")||(O.call(e,!0),j.call(e,!0),U.call(e,!0),k.call(e,!0)),h(e,"onIntervalEnd")}function N(){R(this,!0)}function I(){R(this,!1)}function R(e,t){var n=i(e),o=n.state,a=t?"Starting":"STOPPING",r="intervalIDForUpdatingLayout",s=o[r],l=!isNaN(s);t&&!l?(re.info(a,"interval for updating layout."),o[r]=setInterval(n.boundFunctions.doIntervalOfLayoutUpdate,e.options.intervalTimeForUpdatingLayout)):!t&&l&&(re.warn(a,"interval for updating layout."),clearInterval(s),o[r]=NaN)}function B(e){$.call(e)}function C(e){S.call(this,e,!1),$.call(this)}function S(e,t){var n=!0;"object"==typeof e&&e&&(P.call(this,e.contentTopToWindowTopInHangingLayouts,t),H.call(this,e.contentBottomToLowerBoundaryInHangingLayouts,t),n=D.call(this,e.lowerBoundaryRefElement,t),n=W.call(this,e.shouldUseBottomEdgeOfLowerBoundaryRefElement,t)),n&&j.call(this,t),O.call(this,t),U.call(this,t),k.call(this,t)}function O(e){var t={blockHeight:this.elements.chiefContent.offsetHeight};e&&(t.isForcedToUpdate=!0),z.call(this,t)}function U(e){var t={};e&&(t.isForcedToUpdate=!0),t.contentTopToRootTopInFreeLayout=this.elements.chiefContent.offsetTop,z.call(this,t)}function P(e,t){var n={};t&&(n.isForcedToUpdate=!0),e=parseFloat(e),isNaN(e)||(n.contentTopToWindowTopInHangingLayouts=e),z.call(this,n)}function D(e,t){var n={};t&&(n.isForcedToUpdate=!0);var a=this.elements,r=a.root,i="lowerBoundaryRef",s=!0,l="This doesn't make any sense. Ref element NOT renewed.";return null!==e&&(e instanceof Node?o(e,r)?(s=!1,re.warn("The lower boundary ref element","is a descendant of the root element.",l)):e===r&&(s=!1,re.warn("The lower boundary ref element","is the same dom as the root element.",l)):s=!1),!s||a[i]===e||(a[i]=e,!o(r,e)||(this.state.shouldUseBottomEdgeOfLowerBoundaryRefElement=!0,!1))}function H(e,t){var n={};t&&(n.isForcedToUpdate=!0),e=parseFloat(e),isNaN(e)||(n.contentBottomToLowerBoundaryInHangingLayouts=e),z.call(this,n)}function k(e){var t,n=this,o=i(n).state,a=!0,r=!0;o.layouts.isFreeLayout||(e?(o.shouldRenewFreeLayoutInfoNextTimeEnteringFreeLayout=!1,t=n.state.methodForSwitchingToCurrentLayout,r=J(n,e,!0)):(a=!1,o.shouldRenewFreeLayoutInfoNextTimeEnteringFreeLayout=!0)),a&&A(n,e),r||"function"!=typeof t||t(n)}function A(e,t){var n=e.elements.chiefContent.getBoundingClientRect();if(0===n.width&&0===n.height)return void re.warn('\n\t Cannot evaluate chiefContentElement\'s "boundingClientRect"!',"\n\t The chief content elment might not be visible at the moment.");var o={};t&&(o.isForcedToUpdate=!0),o.contentTopToPageTopInFreeLayout=n.top+window.scrollY,z.call(e,o)}function W(e,t){var n=this,a=n.elements;if(o(a.root,a.lowerBoundaryRef)||null===e||void 0===e)return!0;n.state.shouldUseBottomEdgeOfLowerBoundaryRefElement=!!e;var r={};return t&&(r.isForcedToUpdate=!0),j.call(this,t),!1}function j(e){var t=x(this);e&&(t.isForcedToUpdate=!0),z.call(this,t)}function x(e){var t,n=e.state,o="hangingLowerBoundaryToPageTop",a=e.elements[o],r=NaN,s=NaN;a instanceof Node&&(t=a.getBoundingClientRect(),0===t.width&&0===t.height?re.warn("Reference element for deciding hanging lower boundary is invisible at this moment."):(r=t[n.shouldUseBottomEdgeOfLowerBoundaryRefElement?"bottom":"top"],s=r+window.scrollY)),i(e).state.hangingLowerBoundaryToWindowTop=r,n[o]=s;var l={};return l[o]=s,l}function z(e){var t=this,o=i(t).updatingStatesQueue;!o[o.length-1]&&o.push({});var a=o[o.length-1];"function"==typeof e?e.call(t,a):"object"!=typeof e||Array.isArray(e)?a.isForcedToUpdate=a.isForcedToUpdate||void 0===e||!!e:n(a,e)}function G(e){var t=i(e),n=t.updatingStatesQueue.shift();return M(e,e.state,n),n}function _(e,t){n(e.state,t)}function M(e,t,n){Q(e,t,n),q(e,n)}function Q(e,t,n){Object.keys(e.state).forEach(function(o){Y(o,t,n)?i(e).state.somethingChanged=!0:delete n[o]})}function Y(e,t,n){var o=!1,a=t[e],r=n[e];return void 0!==r&&null!==r&&(void 0===a||null===a?o=!0:a!==r&&(o=!(isNaN(a)&&isNaN(r))),o)}function q(e,t){if(i(e).state.somethingChanged){var n,o,a,r;if("boolean"==typeof t.shouldEnable){n="reason";var s=t.shouldEnable;o=s?"Enabling":t.shouldDestroyAfterDisabled?"DESTORYING":"DISABLING",a="behaviour...\n",r=t[n],r=oe.slice("Reason: ".length)+"Reason: "+r.replace(/\n/g,"\n "+oe),s?re.info(o,a,r):re.warn(o,a," ",r)}}}function $(){var e=this,t=i(e),n=e.state;if(!(t.updatingStatesQueue.length<1)){var o=G(e),a=o.isForcedToUpdate;delete o.isForcedToUpdate,(t.state.somethingChanged||a)&&(_(e,o),V(e,a)),"boolean"==typeof o.shouldEnable&&(m(e,o.shouldEnable),delete n.reason)}}function V(e,t){var n=i(e).state,o=e.state,a=e.elements;x(e);var r=o.contentTopToWindowTopInHangingLayouts,s=window.scrollY+r,l=o.hangingLowerBoundaryToPageTop-o.contentTopToPageTopInFreeLayout,u=o.blockHeight+o.contentBottomToLowerBoundaryInHangingLayouts,d=n.hangingLowerBoundaryToWindowTop-r,c=o.blockHeight,f=window.innerHeight<u||!isNaN(l)&&l<u;!o.shouldEnable||f||s<=o.contentTopToPageTopInFreeLayout?J(e,t):d<=u?X(e,t,c,l-u+a.root.clientTop+o.contentTopToRootTopInFreeLayout):K(e,t,c,o.contentTopToWindowTopInHangingLayouts),n.somethingChanged=!1,delete o.methodForSwitchingToCurrentLayout}function J(e,t,n){var o=i(e).state,a=o.layouts.isFreeLayout,r=Z(e,{methodForSwitchingToCurrentLayout:J,isForcedToUpdate:t,pNameOfLayoutMark:"isFreeLayout",pNameOfCssClass:n?"layoutFreeTemporary":"layoutFree",rootElHeight:"",contentElTop:""});if(!r){var s=e.options.shouldAlwaysRenewFreeLayoutInfo;!s&&!o.shouldRenewFreeLayoutInfoNextTimeEnteringFreeLayout||a||C.call(e),o.shouldRenewFreeLayoutInfoNextTimeEnteringFreeLayout=!1}return r}function K(e,t,n,o){return Z(e,{methodForSwitchingToCurrentLayout:K,isForcedToUpdate:t,pNameOfLayoutMark:"isPinnedToWindowTop",pNameOfCssClass:"layoutPinToWindowTop",rootElHeight:n+"px",contentElTop:o+"px"})}function X(e,t,n,o){return Z(e,{methodForSwitchingToCurrentLayout:X,isForcedToUpdate:t,pNameOfLayoutMark:"isPinnerToParentBottom",pNameOfCssClass:"layoutPinToParentBottom",rootElHeight:n+"px",contentElTop:o+"px"})}function Z(e,t){var n=i(e).state,o=e.state,a=e.elements,r=t.pNameOfLayoutMark,s=t.logStringWhenActuallySwitching;return!(!n.layouts[r]||n.somethingChanged||t.isForcedToUpdate)||(t.shouldDebug&&s&&re.info(s),o.methodForSwitchingToCurrentLayout=t.methodForSwitchingToCurrentLayout,ee(e,r),te(e,t.pNameOfCssClass),a.chiefContent.style.top=t.contentElTop,a.root.style.height=t.rootElHeight,!1)}function ee(e,t){var n=i(e).state.layouts;Object.keys(n).forEach(function(e){n[e]=t===e})}function te(e,t){var n=e.elements.chiefContent.classList,o=e.options.cssClassName;for(var a in o){var r=o[a];a===t?r&&n.add(r):r&&n.remove(r)}}var ne="{"+e+"} ==>",oe=ne.replace(/\S/g," "),ae=window.console,re={};["log","info","warn","debug","trace","error"].forEach(function(e){var t=ae[e];"function"==typeof t&&(re[e]=t.bind(ae,ne))});var ie={};return function(n){var o=this;if(o.console=re,o.options={shouldEnableOnInit:!1,shouldAlwaysRenewFreeLayoutInfo:!0,cssClassName:{layoutFreeTemporary:"js-stick-on-both-edges-layout-temporarily-free",layoutFree:"js-stick-on-both-edges-layout-free",layoutPinToWindowTop:"js-stick-on-both-edges-layout-hang-to-window-top",layoutPinToParentBottom:"js-stick-on-both-edges-layout-pin-to-lower-boundary"},intervalTimeForRenewingState:500,intervalTimeForUpdatingLayout:40,throttleTimeForScrollAndResizeListeners:16},o.state={shouldEnable:!1,blockHeight:NaN,contentTopToPageTopInFreeLayout:NaN,contentTopToRootTopInFreeLayout:0,contentTopToWindowTopInHangingLayouts:0,contentBottomToLowerBoundaryInHangingLayouts:15,shouldUseBottomEdgeOfLowerBoundaryRefElement:!0,hangingLowerBoundaryToPageTop:NaN},n=n||{},!(n.rootElement instanceof Node))throw new Error("Invalid root element.");if(!(n.chiefContentElement instanceof Node))throw new Error("Invalid chiefContent element.");o.elements={root:n.rootElement,chiefContent:n.chiefContentElement,lowerBoundaryRef:null};var a={state:{layouts:{isFreeLayout:!0,isPinnedToWindowTop:!1,isPinnerToParentBottom:!1},isEnabled:!1,somethingChanged:!1,hangingLowerBoundaryToWindowTop:NaN,shouldRenewFreeLayoutInfoNextTimeEnteringFreeLayout:!1,intervalIDForRenewingState:NaN,intervalIDForUpdatingLayout:NaN},events:{},boundFunctions:{},updatingStatesQueue:[]};o.__pToken=t(ie,e),ie[o.__pToken]=a,o.config=c,o.isEnabled=l,o.currentLayout=u,o.currentLayoutIs=d,o.enableOrDisable=p,o.enable=T,o.disable=w,o.destroy=y,o.renewStateAndThenUpdate=C,o.renewState=S,o.renewContentTopToWindowTopInHangingLayouts=P,o.renewHangingLowerBoundaryValue=j,o.renewUsedEdgeOfLowerBoundaryRefElement=W,o.startIntervalOfRenewingState=L,o.clearIntervalOfRenewingState=b,o.startIntervalOfLayoutUpdate=N,o.clearIntervalOfLayoutUpdate=I,o.requestLayoutUpdate=z,o.updateLayout=$,r(o,n)}}("StickOnBothEdges",t,n,o,window.jQuery.throttle||window.Cowboy.throttle)}();