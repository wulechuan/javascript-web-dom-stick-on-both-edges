module.exports=function(e){function t(e,t){function n(){return t+Date.now()+"-"+(1e6*Math.random()+"").slice(0,6)}t="string"==typeof t?t:"",t=t.replace(/\-+$/,"")+"-";for(var o=n();e[o];)o=n();return o}function n(e,t){if(!e||"object"!=typeof e)return null;if(!t||"object"!=typeof t)return e;for(var n in t){var o=t[n];void 0!==o&&(Array.isArray(o)&&Array.isArray(e[n])?Array.prototype.push.apply(e[n],o):e[n]=o)}return e}function o(e,t){if(!(e instanceof Node&&t instanceof Node))return!1;for(var n=!1;e!==t&&e!==document.documentElement;)(e=e.parentNode)===t&&(n=!0);return n}return function(e,t,n,o,a){"use strict";function r(e,t){e.config(t),s(e),S.call(e,t,!0),"boolean"==typeof t.shouldEnable?p.call(t.shouldEnable,t.reasonForEnablingOrDisabling||t.reason||"User desired on initialization."):e.options.shouldEnableOnInit&&T.call(e,"Forced to enabled on initialization."),q.call(e);var n=i(e).boundFunctions;window.addEventListener("scroll",n.listenToScrollEvent)}function i(e){return re[e.__pToken]}function s(e){var t=i(e).boundFunctions;t.doIntervalOfRenewingState=E.bind(null,e),t.doIntervalOfLayoutUpdate=B.bind(null,e),t.doUpdateLayout=function(){$(e)}.bind(e);var n=a(e.options.throttleTimeForScrollAndResizeListeners,t.doUpdateLayout);t.listenToScrollEvent=n,t.listenToResizeEvent=n}function l(){return i(this).state.isEnabled}function u(){var e=i(this).state.layouts;if(e.isFreeLayout)return"free layout";if(e.isPinnedToWindowTop)return"pinned to top";if(e.isPinnerToParentBottom)return"following lower boundry";throw RangeError(te,"Fatal: None of the three states are active.")}function d(e){var t=i(this).state.layouts;if(!e||"string"!=typeof e)return!1;switch(e.toLowerCase().replace(/\s*[\s\-]\s*/g,"-").replace(/^\s+/,"").replace(/\s+$/,"")){case"free":case"freelayout":case"default":return t.isFreeLayout;case"top":case"hanging":case"pinned-to-top":return t.isPinnedToWindowTop;case"following":case"bottom":case"following-lower-boundry":case"pinned-to-bottom":return t.isPinnerToParentBottom}return!1}function c(e){var t,n,a,r=this,i=r.options,s=r.elements;if(t="hangingLowerBoundryRef",n=t+"Element",e.hasOwnProperty(n)){a=e[n];var l=!0;if(null!==a)if(a instanceof Node){var u=s.root;o(a,u)||a===u?(l=!1,ae.warn("The lower boundry ref element is a descendant of the root element. This doesn't make any sense.")):o(u,a)&&(i.shouldUseBottomEdgeOfLowerBoundryRefElement=!0)}else l=!1;l&&s[t]!==a&&(s[t]=a)}t="intervalTimeForRenewingState",e.hasOwnProperty(t)&&(a=parseInt(e[t]),!isNaN(a)&&a>20&&(i[t]=a)),t="intervalTimeForUpdatingLayout",e.hasOwnProperty(t)&&(a=parseInt(e[t]),!isNaN(a)&&a>20&&(i[t]=a)),f(r,"onEnabling",e),f(r,"onEnabled",e),f(r,"onDisabling",e),f(r,"onDisabled",e),f(r,"onDestroying",e),f(r,"onDestroyed",e),f(r,"onReturningToFreeLayout",e),f(r,"onReturnedToFreeLayout",e),f(r,"onIntervalBegin",e),f(r,"onIntervalEnd",e)}function f(e,t,n){var o=i(e).events,a=n[t];"function"!=typeof a&&void 0!==a||(o[t]=a)}function h(e,t,n){var o=i(e).events;return"function"!=typeof o[t]?void(n&&ae.warn('The "'+t+'" is NOT handled.')):o[t].call(e,e.state)}function g(e){w.call(this,e,!0)}function y(e){var t=e.elements,n=i(e).boundFunctions;window.removeEventListener("scroll",n.listenToScrollEvent),window.removeEventListener("resize",n.listenToResizeEvent),t.root.style.height="",t.chiefContent.style.top="",ee(e,null),h(e,"onDestroyed",!0)}function p(e,t,n){if(void 0!==e){e=!!e;if(v(this,e,n)){var o=e?"Enabling":n?"DESTORYING":"DISABLING";return void ae.warn(o,"request was cancelled.")}var a={};a.shouldEnable=!!e,a.reason=t&&"string"==typeof t?t:"<unkown>",!e&&n&&(a.isForcedToRenew=!0,a.shouldDestroyAfterDisabled=!0),x.call(this,a),q.call(this)}}function T(e){p.call(this,!0,e)}function w(e,t){p.call(this,!1,e,t)}function v(e,t,n){if(t)return h(e,"onEnabling");var o=h(e,"onDisabling");if(o){if(!n)return o;ae.warn("Destroying request will be cancelled by onDisabling handler.")}return h(e,"onDestroying")}function m(e,t){var n=e.state;i(e).state.isEnabled=t,t?(delete n.shouldDestroyAfterDisabled,h(e,"onEnabled")):(h(e,"onDisabled"),e.clearIntervalOfRenewingState(),e.clearIntervalOfLayoutUpdate(),n.shouldDestroyAfterDisabled&&y(e))}function L(){F(this,!0)}function b(){F(this,!1)}function F(e,t){var n=i(e),o=n.state,a=t?"Starting":"STOPPING",r="interval for renewing related info.",s="intervalIDForRenewingState",l=o[s],u=!isNaN(l);t&&!u?(ae.info(a,r),o[s]=setInterval(n.boundFunctions.doIntervalOfRenewingState,e.options.intervalTimeForRenewingState)):!t&&u&&(ae.warn(a,r),clearInterval(l),o[s]=NaN)}function E(e){h(e,"onIntervalBegin")||(O.call(e,!0),W.call(e,!0),U.call(e,!0),H.call(e,!0)),h(e,"onIntervalEnd")}function N(){R(this,!0)}function I(){R(this,!1)}function R(e,t){var n=i(e),o=n.state,a=t?"Starting":"STOPPING",r="intervalIDForUpdatingLayout",s=o[r],l=!isNaN(s);t&&!l?(ae.info(a,"interval for updating layout."),o[r]=setInterval(n.boundFunctions.doIntervalOfLayoutUpdate,e.options.intervalTimeForUpdatingLayout)):!t&&l&&(ae.warn(a,"interval for updating layout."),clearInterval(s),o[r]=NaN)}function B(e){q.call(e)}function C(e){S.call(this,e,!1),q.call(this)}function S(e,t){var n=!0;"object"==typeof e&&e&&(P.call(this,e.contentTopToWindowTopInHangingLayouts,t),D.call(this,e.contentBottomToLowerBoundryInHangingLayouts,t),n=A.call(this,e.shouldUseBottomEdgeOfLowerBoundryRefElement,t)),n&&W.call(this,t),O.call(this,t),U.call(this,t),H.call(this,t)}function O(e){var t={blockHeight:this.elements.chiefContent.offsetHeight};e&&(t.isForcedToUpdate=!0),x.call(this,t)}function U(e){var t={};e&&(t.isForcedToUpdate=!0),t.contentTopToRootTopInFreeLayout=this.elements.chiefContent.offsetTop,x.call(this,t)}function P(e,t){var n={};t&&(n.isForcedToUpdate=!0),e=parseFloat(e),isNaN(e)||(n.contentTopToWindowTopInHangingLayouts=e),x.call(this,n)}function D(e,t){var n={};t&&(n.isForcedToUpdate=!0),e=parseFloat(e),isNaN(e)||(n.contentBottomToLowerBoundryInHangingLayouts=e),x.call(this,n)}function H(e){var t,n=this,o=i(n).state,a=!0,r=!0;o.layouts.isFreeLayout||(e?(o.shouldRenewFreeLayoutInfoNextTimeEnteringFreeLayout=!1,t=n.state.methodForSwitchingToCurrentLayout,r=V(n,e,!0)):(a=!1,o.shouldRenewFreeLayoutInfoNextTimeEnteringFreeLayout=!0)),a&&k(n,e),r||"function"!=typeof t||t(n)}function k(e,t){var n=e.elements.chiefContent.getBoundingClientRect();if(0===n.width&&0===n.height)return void ae.warn('\n\t Cannot evaluate chiefContentElement\'s "boundingClientRect"!',"\n\t The chief content elment might not be visible at the moment.");var o={};t&&(o.isForcedToUpdate=!0),o.contentTopToPageTopInFreeLayout=n.top+window.scrollY,x.call(e,o)}function A(e,t){var n=this,o=n.elements;if(o.parentPositionRef===o.hangingLowerBoundryRef||null===e||void 0===e)return!0;n.state.shouldUseBottomEdgeOfLowerBoundryRefElement=!!e;var a={};return t&&(a.isForcedToUpdate=!0),W.call(this,t),!1}function W(e){var t=j(this);e&&(t.isForcedToUpdate=!0),x.call(this,t)}function j(e){var t,n=e.state,o="hangingLowerBoundryToPageTop",a=e.elements[o],r=NaN,s=NaN;a instanceof Node&&(t=a.getBoundingClientRect(),0===t.width&&0===t.height?ae.warn("Reference element for deciding hanging lower boundry is invisible at this moment."):(r=t[n.shouldUseBottomEdgeOfLowerBoundryRefElement?"bottom":"top"],s=r+window.scrollY)),i(e).state.hangingLowerBoundryToWindowTop=r,n[o]=s;var l={};return l[o]=s,l}function x(e){var t=this,o=i(t).updatingStatesQueue;!o[o.length-1]&&o.push({});var a=o[o.length-1];"function"==typeof e?e.call(t,a):"object"!=typeof e||Array.isArray(e)?a.isForcedToUpdate=a.isForcedToUpdate||void 0===e||!!e:n(a,e)}function z(e){var t=i(e),n=t.updatingStatesQueue.shift();return _(e,e.state,n),n}function G(e,t){n(e.state,t)}function _(e,t,n){M(e,t,n),Y(e,n)}function M(e,t,n){Object.keys(e.state).forEach(function(o){Q(o,t,n)?i(e).state.somethingChanged=!0:delete n[o]})}function Q(e,t,n){var o=!1,a=t[e],r=n[e];return void 0!==r&&null!==r&&(void 0===a||null===a?o=!0:a!==r&&(o=!(isNaN(a)&&isNaN(r))),o)}function Y(e,t){if(i(e).state.somethingChanged){var n,o,a,r;if("boolean"==typeof t.shouldEnable){n="reason";var s=t.shouldEnable;o=s?"Enabling":t.shouldDestroyAfterDisabled?"DESTORYING":"DISABLING",a="behaviour...\n",r=t[n],r=ne.slice("Reason: ".length)+"Reason: "+r.replace(/\n/g,"\n "+ne),s?ae.info(o,a,r):ae.warn(o,a," ",r)}}}function q(){var e=this,t=i(e),n=e.state;if(!(t.updatingStatesQueue.length<1)){var o=z(e),a=o.isForcedToUpdate;delete o.isForcedToUpdate,(t.state.somethingChanged||a)&&(G(e,o),$(e,a)),"boolean"==typeof o.shouldEnable&&(m(e,o.shouldEnable),delete n.reason)}}function $(e,t){var n=i(e).state,o=e.state,a=e.elements;j(e);var r=o.contentTopToWindowTopInHangingLayouts,s=window.scrollY+r,l=o.hangingLowerBoundryToPageTop-o.contentTopToPageTopInFreeLayout,u=o.blockHeight+o.contentBottomToLowerBoundryInHangingLayouts,d=n.hangingLowerBoundryToWindowTop-r,c=o.blockHeight,f=window.innerHeight<u||!isNaN(l)&&l<u;!o.shouldEnable||f||s<=o.contentTopToPageTopInFreeLayout?V(e,t):d<=u?K(e,t,c,l-u+a.root.clientTop+o.contentTopToRootTopInFreeLayout):J(e,t,c,o.contentTopToWindowTopInHangingLayouts),n.somethingChanged=!1,delete o.methodForSwitchingToCurrentLayout}function V(e,t,n){var o=i(e).state,a=o.layouts.isFreeLayout,r=X(e,{methodForSwitchingToCurrentLayout:V,isForcedToUpdate:t,pNameOfLayoutMark:"isFreeLayout",pNameOfCssClass:n?"layoutFreeTemporary":"layoutFree",rootElHeight:"",contentElTop:""});if(!r){var s=e.options.shouldAlwaysRenewFreeLayoutInfo;!s&&!o.shouldRenewFreeLayoutInfoNextTimeEnteringFreeLayout||a||C.call(e),o.shouldRenewFreeLayoutInfoNextTimeEnteringFreeLayout=!1}return r}function J(e,t,n,o){return X(e,{methodForSwitchingToCurrentLayout:J,isForcedToUpdate:t,pNameOfLayoutMark:"isPinnedToWindowTop",pNameOfCssClass:"layoutPinToWindowTop",rootElHeight:n+"px",contentElTop:o+"px"})}function K(e,t,n,o){return X(e,{methodForSwitchingToCurrentLayout:K,isForcedToUpdate:t,pNameOfLayoutMark:"isPinnerToParentBottom",pNameOfCssClass:"layoutPinToParentBottom",rootElHeight:n+"px",contentElTop:o+"px"})}function X(e,t){var n=i(e).state,o=e.state,a=e.elements,r=t.pNameOfLayoutMark,s=t.logStringWhenActuallySwitching;return!(!n.layouts[r]||n.somethingChanged||t.isForcedToUpdate)||(t.shouldDebug&&s&&ae.info(s),o.methodForSwitchingToCurrentLayout=t.methodForSwitchingToCurrentLayout,Z(e,r),ee(e,t.pNameOfCssClass),a.chiefContent.style.top=t.contentElTop,a.root.style.height=t.rootElHeight,!1)}function Z(e,t){var n=i(e).state.layouts;Object.keys(n).forEach(function(e){n[e]=t===e})}function ee(e,t){var n=e.elements.chiefContent.classList,o=e.options.cssClassName;for(var a in o){var r=o[a];a===t?r&&n.add(r):r&&n.remove(r)}}var te="{"+e+"} ==>",ne=te.replace(/\S/g," "),oe=window.console,ae={};["log","info","warn","debug","trace","error"].forEach(function(e){var t=oe[e];"function"==typeof t&&(ae[e]=t.bind(oe,te))});var re={};return function(n){var o=this;if(o.console=ae,o.options={shouldEnableOnInit:!1,shouldAlwaysRenewFreeLayoutInfo:!0,cssClassName:{layoutFreeTemporary:"js-stick-on-both-edges-layout-temporarily-free",layoutFree:"js-stick-on-both-edges-layout-free",layoutPinToWindowTop:"js-stick-on-both-edges-layout-hang-to-window-top",layoutPinToParentBottom:"js-stick-on-both-edges-layout-pin-to-lower-boundry"},intervalTimeForRenewingState:500,intervalTimeForUpdatingLayout:40,throttleTimeForScrollAndResizeListeners:16},o.state={shouldEnable:!1,blockHeight:NaN,contentTopToPageTopInFreeLayout:NaN,contentTopToRootTopInFreeLayout:0,contentTopToWindowTopInHangingLayouts:0,contentBottomToLowerBoundryInHangingLayouts:15,shouldUseBottomEdgeOfLowerBoundryRefElement:!1,hangingLowerBoundryToPageTop:NaN},n=n||{},!(n.rootElement instanceof Node))throw new Error("Invalid root element.");if(!(n.chiefContentElement instanceof Node))throw new Error("Invalid chiefContent element.");o.elements={root:n.rootElement,chiefContent:n.chiefContentElement,hangingLowerBoundryRef:null};var a={state:{layouts:{isFreeLayout:!0,isPinnedToWindowTop:!1,isPinnerToParentBottom:!1},isEnabled:!1,somethingChanged:!1,hangingLowerBoundryToWindowTop:NaN,shouldRenewFreeLayoutInfoNextTimeEnteringFreeLayout:!1,intervalIDForRenewingState:NaN,intervalIDForUpdatingLayout:NaN},events:{},boundFunctions:{},updatingStatesQueue:[]};o.__pToken=t(re,e),re[o.__pToken]=a,o.config=c,o.isEnabled=l,o.currentLayout=u,o.currentLayoutIs=d,o.enableOrDisable=p,o.enable=T,o.disable=w,o.destroy=g,o.renewStateAndThenUpdate=C,o.renewState=S,o.renewContentTopToWindowTopInHangingLayouts=P,o.renewHangingLowerBoundryValue=W,o.renewUsedEdgeOfLowerBoundryRefElement=A,o.startIntervalOfRenewingState=L,o.clearIntervalOfRenewingState=b,o.startIntervalOfLayoutUpdate=N,o.clearIntervalOfLayoutUpdate=I,o.requestLayoutUpdate=x,o.updateLayout=q,r(o,n)}}("StickOnBothEdges",t,n,o,window.jQuery.throttle||window.Cowboy.throttle)}();